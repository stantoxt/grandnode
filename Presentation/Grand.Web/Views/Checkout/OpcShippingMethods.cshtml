@model CheckoutShippingMethodModel
@using Grand.Web.Models.Checkout;

<script type="text/javascript">
    function loadPartialView(arg_value) {
        var result = arg_value.split("___");
        var argument = result[0];
        var controller = result[1].replace('Shipping.', '') + "Shipping";

        console.log(argument);
        console.log(controller);

        var url = '@(Request.Url.AbsoluteUri.Replace(Request.Url.PathAndQuery, string.Empty))' + "/" + controller + '/GetFormPartialView?shippingOption=' + argument;

        $.ajax({
            url: url,
            success: function (data) {
                $('#shipping_form').html(data);
            }
        });
    }
</script>

<div class="checkout-data">
    <div class="shipping-method">
        @Html.Widget("op_checkout_shipping_method_top")
        @if (Model.Warnings.Count == 0)
        {
            for (int i = 0; i < Model.ShippingMethods.Count; i++)
                {
                    var shippingMethod = Model.ShippingMethods[i];

                    if (shippingMethod.Selected)
                    {
                    <script type="text/javascript">
                        $(document).ready(function () {
                            loadPartialView('@(shippingMethod.Name)___@(shippingMethod.ShippingRateComputationMethodSystemName)');
                        });
                    </script>
                }
                <ul class="method-list">

                    <li>
                        <label class="custom-control custom-checkbox">
                            <input onclick="loadPartialView(value)"
                                   id="shippingoption_@(i)"
                                   class="custom-control-input"
                                   type="radio"
                                   name="shippingoption"
                                   value="@(shippingMethod.Name)___@(shippingMethod.ShippingRateComputationMethodSystemName)"
                                   checked="@shippingMethod.Selected" />
                            <span class="custom-control-indicator"></span>
                            <span for="shippingoption_@(i)" class="custom-control-description">
                                @T("Checkout.SelectShippingMethod.MethodAndFee", shippingMethod.Name, shippingMethod.Fee)

                                @if (!String.IsNullOrEmpty(shippingMethod.Description))
                                {
                                    @Html.Raw(shippingMethod.Description)
                                }

                            </span>
                        </label>
                    </li>
                </ul>

            }
            if (Model.NotifyCustomerAboutShippingFromMultipleLocations)
            {
                <div class="multiple-locations">
                    @T("Checkout.ShippingMethod.ShippingFromMultipleLocations")
                </div>
            }
            <div id="shipping_form"></div>
        }
        else
        {
            <div class="message-error">
                <ul>
                    @foreach (var warning in Model.Warnings)
                    {
                        <li>@warning</li>
                    }
                </ul>
            </div>
        }
        @Html.Widget("op_checkout_shipping_method_bottom")
    </div>
</div>
